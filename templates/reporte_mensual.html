{% extends 'base.html' %}
{% load static %}
{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/reporte_mensual.css' %}">
{% endblock %}
{% block content %}

<div class="container my-5">
  <h2 class="mb-4 text-primary text-center">Reporte Mensual</h2>

  <!-- Filtros y búsqueda -->
  <form method="get" class="row g-2 mb-4">
    <div class="col-auto">
      <input type="text" name="buscar" class="form-control form-control-sm" placeholder="Buscar..." value="{{ request.GET.buscar }}">
    </div>
    <div class="col-auto">
      <select name="tipo_convocatoria" class="form-select form-select-sm">
        <option value="">Tipo Convocatoria</option>
        {% for tipo in convocatorias_por_tipo %}
          <option value="{{ tipo.tipo }}" {% if request.GET.tipo_convocatoria == tipo.tipo %}selected{% endif %}>{{ tipo.tipo|capfirst }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-auto">
      <select name="estado_inscripcion" class="form-select form-select-sm">
        <option value="">Estado Inscripción</option>
        {% for estado in inscripciones_por_estado %}
          <option value="{{ estado.estado }}" {% if request.GET.estado_inscripcion == estado.estado %}selected{% endif %}>{{ estado.estado|capfirst }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-auto">
      <select name="nivel" class="form-select form-select-sm">
        <option value="">Nivel</option>
        {% for nivel in resultados_por_nivel %}
          <option value="{{ nivel.nota }}" {% if request.GET.nivel == nivel.nota %}selected{% endif %}>{{ nivel.nota }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-auto">
      <button type="submit" class="btn btn-outline-primary btn-sm">Filtrar</button>
    </div>
  </form>

  <!-- Resumen general -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card text-center shadow">
        <div class="card-body">
          <h5 class="card-title">Convocatorias</h5>
          <p class="display-6">{{ convocatorias_total }}</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-center shadow">
        <div class="card-body">
          <h5 class="card-title">Inscripciones</h5>
          <p class="display-6">{{ inscripciones_total }}</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-center shadow">
        <div class="card-body">
          <h5 class="card-title">Resultados</h5>
          <p class="display-6">{{ resultados_total }}</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-center shadow">
        <div class="card-body">
          <h5 class="card-title">Periodo</h5>
          <p class="mb-0">{{ inicio_mes }}<br>a<br>{{ fin_mes }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Tabla de convocatorias por tipo -->
  <h4 class="mt-4">Convocatorias por Tipo</h4>
  <div class="table-responsive mb-4">
    <table class="table table-bordered table-hover">
      <thead class="table-light">
        <tr>
          <th>Tipo</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody>
        {% for tipo in convocatorias_por_tipo %}
        <tr>
          <td>{{ tipo.tipo|capfirst }}</td>
          <td>{{ tipo.total }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="2">No hay datos.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Tabla de inscripciones por estado -->
  <h4 class="mt-4">Inscripciones por Estado</h4>
  <div class="table-responsive mb-4">
    <table class="table table-bordered table-hover">
      <thead class="table-light">
        <tr>
          <th>Estado</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody>
        {% for estado in inscripciones_por_estado %}
        <tr>
          <td>{{ estado.estado|capfirst }}</td>
          <td>{{ estado.total }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="2">No hay datos.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Tabla de inscripciones por convocatoria -->
  <h4 class="mt-4">Inscripciones por Convocatoria</h4>
  <div class="table-responsive mb-4">
    <table class="table table-bordered table-hover">
      <thead class="table-light">
        <tr>
          <th>Convocatoria</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody>
        {% for conv in inscripciones_por_convocatoria %}
        <tr>
          <td>{{ conv.convocatoria__descripcion }}</td>
          <td>{{ conv.total }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="2">No hay datos.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Tabla de resultados por nivel -->
  <h4 class="mt-4">Resultados por Nivel</h4>
  <div class="table-responsive mb-4">
    <table class="table table-bordered table-hover">
      <thead class="table-light">
        <tr>
          <th>Nivel</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody>
        {% for nivel in resultados_por_nivel %}
        <tr>
          <td>{{ nivel.nota }}</td>
          <td>{{ nivel.total }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="2">No hay datos.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% endblock %}